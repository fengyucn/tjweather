# 多要素查询指南

## ✅ API和CLI都支持多要素查询

天机气象API支持一次请求获取多个气象要素，CLI工具完全支持这个功能。

## 使用方法

### CLI工具多要素查询

```bash
# 基本格式
tjweather query -l "经度,纬度" -f "要素1,要素2,要素3"

# 示例：查询温度和湿度
tjweather query -l "116.23128,40.22077" -f "t2m,rh2m" -d 3

# 示例：查询更多要素（如果API支持）
tjweather query -l "116.23128,40.22077" -f "t2m,rh2m,ws100m,ssrd,slp" -d 1
```

### API直接调用

```bash
# API请求格式
curl "https://api.tjweather.com/beta?key=YOUR_API_KEY&loc=116.23128,40.22077&fields=t2m,rh2m&fcst_days=3"
```

## 测试结果验证

### ✅ 已验证的多要素组合

```bash
# 温度 + 湿度（完全可用）
tjweather query -l "116.23128,40.22077" -f "t2m,rh2m" -d 3
```

**输出示例：**
```
天气数据 (起报时间: 2025-11-24T20:00+08:00)
单位: {"t2m": "°C", "rh2m": "%"}

┌────────────────────┬────────────┬────────────┐
│ 时间               │ t2m        │ rh2m       │
├────────────────────┼────────────┼────────────┤
│ 2025-11-24T21:00+… │ 3.15       │ 37.27      │
│ 2025-11-24T22:00+… │ 2.32       │ 39.90      │
└────────────────────┴────────────┴────────────┘
```

### ⚠️ 需要订阅的要素

某些要素需要额外的API订阅：

```bash
# 这些要素会返回20003错误（未订阅）
tjweather query -l "116.23128,40.22077" -f "ws100m,ssrd,slp" -d 1
```

**错误示例：**
```
查询失败 (20003): 要素[ws100m]未订阅
```

## 支持的要素类型

### 全球要素
- `t2m`: 2米温度 (°C) ✅
- `rh2m`: 2米相对湿度 (%) ✅
- `ws100m`: 100米风速 (m/s) ❌ (需订阅)
- `ssrd`: 辐照度 (W/㎡) ❌ (需订阅)
- `slp`: 海平面气压 (mb) ❌ (需订阅)
- `cldt`: 总云量 ❌ (需订阅)

### 中国特有要素
- `ws30m`: 30米风速 ❌ (需订阅)
- `ws50m`: 50米风速 ❌ (需订阅)
- `ws70m`: 70米风速 ❌ (需订阅)

## 多要素查询示例

### 1. 基本多要素查询
```bash
# 温度 + 湿度
tjweather query -l "116.23128,40.22077" -f "t2m,rh2m" -d 7

# 3天预报，多要素
tjweather query -l "121.4737,31.2304" -f "t2m,rh2m" -d 3
```

### 2. 高分辨率多要素查询
```bash
# 15分钟分辨率，24小时预报
tjweather query -l "116.23128,40.22077" -f "t2m,rh2m" -d 0 -h 24 -r 15min
```

### 3. 不同输出格式
```bash
# JSON格式
tjweather query -l "116.23128,40.22077" -f "t2m,rh2m" --format json

# CSV格式（适合数据分析）
tjweather query -l "116.23128,40.22077" -f "t2m,rh2m" --format csv -o weather.csv

# 表格格式（默认）
tjweather query -l "116.23128,40.22077" -f "t2m,rh2m"
```

### 4. 保存多要素数据
```bash
# 保存为CSV
tjweather query -l "116.23128,40.22077" -f "t2m,rh2m" -d 7 --format csv -o weekly_weather.csv

# 保存为JSON
tjweather query -l "116.23128,40.22077" -f "t2m,rh2m" -d 7 --format json -o weekly_weather.json
```

## 输出格式说明

### 表格格式
- 自动适应列宽
- 彩色输出（可禁用）
- 包含所有要素的并列显示

### JSON格式
```json
{
  "code": 200,
  "message": "成功",
  "data": {
    "units": {
      "t2m": "°C",
      "rh2m": "%"
    },
    "data": [
      {
        "time": "2025-11-24T21:00+08:00",
        "t2m": 3.15,
        "rh2m": 37.27
      }
    ]
  }
}
```

### CSV格式
```csv
时间,t2m,rh2m
2025-11-24T21:00+08:00,3.15,37.27
2025-11-24T22:00+08:00,2.32,39.90
```

## 限制和注意事项

1. **API权限限制**：某些要素需要特殊订阅
2. **要素数量限制**：一次最多可查询的要素数量有限制
3. **数据一致性**：所有要素在同一时间点获取，时间戳一致
4. **单位信息**：每个要素都有对应的单位信息

## 最佳实践

1. **合理组合要素**：选择相关的气象要素组合
2. **考虑API限制**：避免一次请求过多要素
3. **使用合适格式**：数据分析用CSV，查看用表格
4. **错误处理**：检查要素订阅状态

## 结论

✅ **完全支持多要素查询** - API和CLI工具都能高效处理多要素请求
✅ **灵活的输出格式** - 支持表格、JSON、CSV等多种格式
✅ **优秀的用户体验** - 简单的命令行语法，清晰的结果展示
⚠️ **注意API权限** - 某些要素需要额外订阅