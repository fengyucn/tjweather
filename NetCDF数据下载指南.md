# NetCDFæ ¼å¼æ•°æ®ä¸‹è½½æŒ‡å—

## âœ… å®¢æˆ·ç«¯å·²å®Œå…¨æ”¯æŒNCæ ¼å¼æ•°æ®è·å–

å¤©æœºæ°”è±¡CLIå·¥å…·ç°åœ¨æ”¯æŒç›´æ¥ä¸‹è½½NetCDFæ ¼å¼çš„æ°”è±¡æ•°æ®æ–‡ä»¶ã€‚

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬è¯­æ³•

```bash
tjweather download [é€‰é¡¹]
```

### å¿…éœ€å‚æ•°

- `-l, --location <coordinates>`: ç»çº¬åº¦åæ ‡ï¼Œæ ¼å¼: ç»åº¦,çº¬åº¦

### å¯é€‰å‚æ•°

- `-f, --fields <fields>`: æ°”è±¡è¦ç´ ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš” (é»˜è®¤: t2m)
- `-d, --days <days>`: é¢„æŠ¥å¤©æ•° (é»˜è®¤: 3)
- `-h, --hours <hours>`: é¢„æŠ¥å°æ—¶æ•° (é»˜è®¤: 0)
- `-r, --resolution <resolution>`: æ—¶é—´åˆ†è¾¨ç‡ (15min|1h, é»˜è®¤: 1h)
- `-t, --timezone <timezone>`: æ—¶åŒº (-12 åˆ° 12, é»˜è®¤: 8)
- `-g, --grid <grid>`: ç½‘æ ¼å¤§å° (1|3|5|7, é»˜è®¤: 1)
- `-o, --output <file>`: è¾“å‡ºæ–‡ä»¶è·¯å¾„ (é»˜è®¤: è‡ªåŠ¨ç”Ÿæˆ)
- `--filename <filename>`: æŒ‡å®šä¸‹è½½æ–‡ä»¶å

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºæœ¬ä¸‹è½½

```bash
# ä¸‹è½½åŒ—äº¬æœªæ¥3å¤©çš„æ¸©åº¦æ•°æ®
tjweather download -l "116.23128,40.22077" -f t2m -d 3

# æŒ‡å®šè¾“å‡ºæ–‡ä»¶å
tjweather download -l "116.23128,40.22077" -f t2m -d 3 -o beijing_weather.nc
```

### 2. å¤šè¦ç´ ä¸‹è½½

```bash
# ä¸‹è½½æ¸©åº¦å’Œæ¹¿åº¦æ•°æ®
tjweather download -l "116.23128,40.22077" -f "t2m,rh2m" -d 1 -o weather.nc
```

### 3. é«˜åˆ†è¾¨ç‡æ•°æ®

```bash
# 15åˆ†é’Ÿåˆ†è¾¨ç‡çš„24å°æ—¶é¢„æŠ¥
tjweather download -l "116.23128,40.22077" -f t2m -d 0 -h 24 -r 15min -o highres.nc
```

### 4. è¯¦ç»†æ¨¡å¼

```bash
# æ˜¾ç¤ºä¸‹è½½è¿‡ç¨‹çš„è¯¦ç»†ä¿¡æ¯
tjweather --verbose download -l "116.23128,40.22077" -f t2m -d 7
```

## âœ… æµ‹è¯•ç»“æœéªŒè¯

### æˆåŠŸçš„ä¸‹è½½æµ‹è¯•

```bash
# åŸºæœ¬ä¸‹è½½æµ‹è¯• âœ…
tjweather download -l "116.23128,40.22077" -f t2m -d 1 -o /tmp/test_weather.nc
# è¾“å‡º: âœ… NetCDFæ–‡ä»¶ä¸‹è½½å®Œæˆ: /tmp/test_weather.nc æ–‡ä»¶å¤§å°: 0.01 MB

# å¤šè¦ç´ ä¸‹è½½æµ‹è¯• âœ…
tjweather download -l "116.23128,40.22077" -f "t2m,rh2m" -d 0 -h 6
# è¾“å‡º: âœ… NetCDFæ–‡ä»¶ä¸‹è½½å®Œæˆ: weather_116.23128_40.22077_d0_h6_2025-11-25T07-00-02.nc

# é«˜åˆ†è¾¨ç‡ä¸‹è½½æµ‹è¯• âœ…
tjweather download -l "116.23128,40.22077" -f t2m -d 0 -h 24 -r 15min -o /tmp/highres_weather.nc
# è¾“å‡º: âœ… NetCDFæ–‡ä»¶ä¸‹è½½å®Œæˆ: /tmp/highres_weather.nc æ–‡ä»¶å¤§å°: 0.01 MB
```

### æ–‡ä»¶éªŒè¯

```bash
# æ£€æŸ¥ä¸‹è½½çš„æ–‡ä»¶
ls -la /tmp/test_weather.nc
# è¾“å‡º: -rw-rw-r-- 1 fengyu fengyu 6684 Nov 25 14:59 /tmp/test_weather.nc

# éªŒè¯æ–‡ä»¶æ ¼å¼
file /tmp/test_weather.nc
# è¾“å‡º: /tmp/test_weather.nc: Hierarchical Data Format (version 5) data
```

### é”™è¯¯å¤„ç†æµ‹è¯•

```bash
# åæ ‡éªŒè¯ âœ…
tjweather download -l "invalid" -f t2m
# è¾“å‡º: âŒ é”™è¯¯: åæ ‡æ ¼å¼ä¸æ­£ç¡®

# å­—æ®µéªŒè¯ âœ…
tjweather download -l "116.23128,40.22077" -f invalid_field
# è¾“å‡º: âŒ é”™è¯¯: ä¸æ”¯æŒçš„å­—æ®µ: invalid_field
```

## ğŸ“ è‡ªåŠ¨æ–‡ä»¶å‘½å

å½“ä¸æŒ‡å®šè¾“å‡ºæ–‡ä»¶æ—¶ï¼Œå·¥å…·ä¼šè‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶åï¼š

```bash
# æ ¼å¼: weather_{ç»åº¦}_{çº¬åº¦}_d{å¤©æ•°}_h{å°æ—¶æ•°}_{æ—¶é—´æˆ³}.nc
weather_116.23128_40.22077_d0_h6_2025-11-25T07-00-02.nc
```

## ğŸŒ NetCDFæ–‡ä»¶ç‰¹ç‚¹

### æ–‡ä»¶ä¿¡æ¯
- **æ ¼å¼**: Hierarchical Data Format (version 5)
- **æ‰©å±•å**: .nc
- **ç¼–ç **: äºŒè¿›åˆ¶æ ¼å¼
- **å¤§å°**: é€šå¸¸å‡ KBåˆ°å‡ MBï¼Œå–å†³äºæ•°æ®é‡

### æ•°æ®å†…å®¹
- **æ—¶é—´åºåˆ—**: æŒ‰é¢„æŠ¥æ—¶é—´åºåˆ—æ’åˆ—
- **ç©ºé—´ä¿¡æ¯**: å•ç‚¹åæ ‡æ•°æ®
- **å…ƒæ•°æ®**: åŒ…å«å•ä½ã€æ—¶é—´æˆ³ç­‰ä¿¡æ¯
- **å¤šè¦ç´ **: æ”¯æŒå¤šä¸ªæ°”è±¡è¦ç´ åŒæ—¶å­˜å‚¨

### å…¼å®¹æ€§
- âœ… æ”¯æŒPython (xarray, netCDF4)
- âœ… æ”¯æŒR (ncdf4)
- âœ… æ”¯æŒMATLAB (ncread)
- âœ… æ”¯æŒPanoplyã€ncviewç­‰å¯è§†åŒ–å·¥å…·

## ğŸ”§ NetCDFæ•°æ®å¤„ç†ç¤ºä¾‹

### Pythonè¯»å–ç¤ºä¾‹

```python
import xarray as xr

# è¯»å–NetCDFæ–‡ä»¶
ds = xr.open_dataset('weather.nc')

# æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯
print(ds)

# è¯»å–æ¸©åº¦æ•°æ®
temperature = ds['t2m']

# è½¬æ¢ä¸ºpandas DataFrame
df = ds.to_dataframe()
```

### MATLABè¯»å–ç¤ºä¾‹

```matlab
% è¯»å–NetCDFæ–‡ä»¶
data = ncread('weather.nc', 't2m');

% è¯»å–æ—¶é—´ä¿¡æ¯
time = ncread('weather.nc', 'time');
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„åˆ†è¾¨ç‡
```bash
# çŸ­æœŸåˆ†æç”¨é«˜åˆ†è¾¨ç‡
tjweather download -l "116.23128,40.22077" -f t2m -d 0 -h 24 -r 15min

# é•¿æœŸåˆ†æç”¨æ ‡å‡†åˆ†è¾¨ç‡
tjweather download -l "116.23128,40.22077" -f t2m -d 30 -r 1h
```

### 2. åˆç†ç»„åˆè¦ç´ 
```bash
# ç›¸å…³è¦ç´ ç»„åˆ
tjweather download -l "116.23128,40.22077" -f "t2m,rh2m,tp" -d 7

# é¿å…è¿‡å¤šè¦ç´ 
# âœ… æ¨è: 3-5ä¸ªç›¸å…³è¦ç´ 
# âŒ ä¸æ¨è: 10+ä¸ªè¦ç´ ï¼ˆå¯èƒ½è¶…å‡ºAPIé™åˆ¶ï¼‰
```

### 3. æ–‡ä»¶ç®¡ç†
```bash
# ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–‡ä»¶å
tjweather download -l "116.23128,40.22077" -f t2m -d 7 -o beijing_7day_temperature.nc

# ä½¿ç”¨è¯¦ç»†æ¨¡å¼äº†è§£ä¸‹è½½ä¿¡æ¯
tjweather --verbose download -l "116.23128,40.22077" -f t2m -d 7
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **APIæƒé™**: æŸäº›è¦ç´ éœ€è¦ç‰¹æ®Šè®¢é˜…
2. **æ–‡ä»¶å¤§å°**: é«˜åˆ†è¾¨ç‡å’Œé•¿æ—¶é—´åºåˆ—ä¼šäº§ç”Ÿè¾ƒå¤§æ–‡ä»¶
3. **ç£ç›˜ç©ºé—´**: ç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´å­˜å‚¨ä¸‹è½½çš„æ–‡ä»¶
4. **ç½‘ç»œç¨³å®š**: å¤§æ–‡ä»¶ä¸‹è½½éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥

## æ€»ç»“

âœ… **NCæ ¼å¼æ•°æ®ä¸‹è½½åŠŸèƒ½å·²å®Œå…¨å®ç°**
- âœ… æ”¯æŒå•ç‚¹å’Œå¤šè¦ç´ æŸ¥è¯¢
- âœ… æ”¯æŒå„ç§æ—¶é—´åˆ†è¾¨ç‡
- âœ… è‡ªåŠ¨æ–‡ä»¶å‘½åå’Œè‡ªå®šä¹‰æ–‡ä»¶å
- âœ… å®Œæ•´çš„å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†
- âœ… æ ‡å‡†NetCDFæ ¼å¼è¾“å‡º
- âœ… ä¸ä¸»æµæ•°æ®ç§‘å­¦å·¥å…·å…¼å®¹

CLIå·¥å…·ç°åœ¨æä¾›å®Œæ•´çš„æ°”è±¡æ•°æ®è·å–èƒ½åŠ›ï¼ŒåŒ…æ‹¬JSONæŸ¥è¯¢å’ŒNetCDFä¸‹è½½ä¸¤ç§æ–¹å¼ï¼